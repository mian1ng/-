# 统计今日总消息量
create table if not exists db_msg.tb_rs_total_msg_cnt comment '每日消息总量' as
select tb_msg_etl.msg_day,count(*) as total_msg_cnt from db_msg.tb_msg_etl group by msg_day;

# 统计今日每小时消息量、发送和接收用户数
create table if not exists db_msg.tb_rs_hour_msg_cnt comment '每小时消息量趋势' as
    select tb_msg_etl.msg_hour ,count(*) as total_msg_cnt,count(distinct tb_msg_etl.sender_account) as sender_user_cnt,
           count(distinct tb_msg_etl.receiver_account) as receiver_user_cnt
from db_msg.tb_msg_etl
group by tb_msg_etl.msg_hour ;

# 统计今日各地区发送消息数据量
create table if not exists tb_rs_loc_cnt comment '今日各地区发送消息总量' as
    select tb_msg_etl.msg_day,tb_msg_etl.sender_lng,tb_msg_etl.sender_lat,count(*) as total_msg_cnt
    from db_msg.tb_msg_etl
           group by msg_day,sender_lng,sender_lat;

# 统计今日发送消息和接收消息的用户数
create table db_msg.tb_rs_user_cnt comment '每日发送和接收消息的人数' as
select
msg_day,count(distinct sender_account) as sender_user_cnt,count(distinct receiver_account) as receiver_user_cnt
    from db_msg.tb_msg_etl
group by msg_day;

# 统计今日发送消息最多的Top10用户
create table db_msg.tb_rs_s_user_top10 comment '发送消息最多的十个用户' as
select
    sender_name,count(*) as sender_msg_cnt
    from db_msg.tb_msg_etl
group by sender_name
order by sender_msg_cnt desc
limit 10;

# 统计今日接收消息最多的Top10用户
create table db_msg.tb_rs_r_user_top10 comment '接收消息最多的十个用户' as
select
    receiver_name,count(*) as receiver_msg_cnt
    from db_msg.tb_msg_etl
group by receiver_name
order by receiver_msg_cnt desc
limit 10;

# 统计发送人的手机型号分布情况
create table db_msg.tb_rs_sender_phone comment '发送人的手机型号分布' as
select
    sender_phonetype,count(*) as cnt
    from db_msg.tb_msg_etl
group by sender_phonetype;

# 统计发送人的设备操作系统分布情况
create table db_msg.tb_rs_sender_os comment '发送人的os分布' as
select
    sender_os,count(*) as cnt
    from db_msg.tb_msg_etl
group by sender_os;
